\documentclass[a4paper,openany]{book}

\usepackage{config/bind}

\settoggle{verbose}{true}

\begin{document}

\frontpage[Optional Title]%
	{Subtitle}%

\mainmatter

\chapter{Stuff}

\begin{multicols}{2}

\goblin

\griffin

\dragon

\newcommand\traits[7]{%
  \clean%
  \npc#1%
  \body#2%
  \mind#3%
  #4%
  \foreach \k in {#5}{%
    \stepcounter{knacks}%
  }%
  \renewcommand\showKnacks{#5}%
  \foreach \s in {Air,Earth,Fate,Fire,Water}%
    {\ifnum\value{\s}>0 \addtocounter{mp}{3}\fi}%
  \renewcommand\equipment{#6}%
  \computeStats%
  #7%
  \computeEncumbrance%
  \calculateXP%
}

%%%%%%%%%%

\newcommand\showChar[1]{
  \begin{exampletext}
  #1
  (\npcsymbol)\quad
  \textbf{\name}
  \foreach\Att in {Strength,Dexterity,Speed}%
    {\Att: \arabic{\Att}\quad}

  \hrulefill

  \quad%
  \foreach\Att in {Intelligence,Wits,Charisma}%
    {\Att: \arabic{\Att}\quad}

  \hrulefill

  \showSkills

  \ifnum\value{mp}>0%
    \noindent\textbf{Spheres}:
    \foreach \s in {Air,Earth,Fate,Fire,Water}%
      {\ifnum\value{\s}>0 \s~\arabic{\s}, \fi}
  \fi

  \ifnum\value{knacks}>0
    \textbf{Knacks}: \showKnacks
  \fi

  \hrulefill

  \ifdefempty{\Abilities}{}{%
    \noindent\textbf{Abilities}: \Abilities
  }

  \ifnum\value{weight}>0
    \noindent\textbf{Equipment}:
    \ifdefempty{\weaponName}{}{%
      \weaponName,
    }%
    \ifdefempty{\armourName}{}{%
      \armourName,
    }%
    \equipment %
  \fi
  \hfill \Repeat{\value{encumbrance}}{~\glsentrytext{encumbrance}}

  {\scshape
    \glsentrytext{ap} \arabic{ap},
    \iftoggle{allyCharacter}{$2D6$\ifnum\value{att}>-1 +\fi}{}%
    Att \arabic{att},
    Dam \dmg{damage}%
    \ifnum\value{dr}>0%
      , \glsentrytext{dr} \arabic{dr} (\arabic{covering}), %
    \fi%
    \iftoggle{examplecharacter}{%
      \arabic{hp}~\glsentrytext{hp}
      \ifnum\value{mp}>0%
        , \glsentrytext{mp} \arabic{mp}, %
      \fi%
      \ifnum\value{fp}>0%
        , \glsentrytext{fp} \arabic{fp}, %
      \fi%
    }{%
      \par%
      \showBoxes%
      \ifnum\value{noAppearing}=1%
        \par\glsentrytext{fp}\ifnum\value{fp}>2~\boxStat{fp}\fi%
      \fi%
    }%
  }
  \end{exampletext}
}

%%%%%%%%%%%%%%%%%%%%

\newcommand\statblock[1]{
    \begin{tcolorbox}[
      code={\setlength\parindent{0pt}#1},
      title={\npcsymbol\ \name},
      ornamented,
      fontupper=\small,
      halign=flush left,
      left=5pt,
      right=5pt,
      top=0pt,
      bottom=10pt,
      ]
      \creaturestats
      \showSkills
      \par
      \ifnum\value{mp}>0%
        \noindent\textbf{Spheres}:
        \foreach \s in {Air,Earth,Fate,Fire,Water}%
          {\ifnum\value{\s}>0 \s~\arabic{\s}, \fi}
      \fi
      \par
      \ifnum\value{knacks}>0
        \textbf{Knacks}: \showKnacks
      \fi
      \ifdefempty{\Abilities}{}{%
        \noindent\textbf{Abilities}: \Abilities
      }
      \noindent\textbf{Equipment}:
      \ifdefempty{\weaponName}{}{%
        \weaponName, %
      }%
      \ifdefempty{\armourName}{}{%
        \armourName, %
      }%
      \equipment%
      \tcblower%%%%%%%%%%%%%%%%%%%%
      \derivedstats%
    \end{tcolorbox}
}

\statblock{
  \traits{{\F\Hu}{Drake}}%
    {{1}{2}{3}}%
    {{3}{0}{2}}%
    {%
      \setcounter{Academics}{1}%
      \setcounter{Deceit}{1}%
      \setcounter{Wyldcrafting}{1}%
      \setcounter{Fire}{1}%
      \setcounter{Air}{3}%
      \longsword%
    }% SKILLS
    {\adrenalinesurge, \mightydraw}% KNACKS
    {butter}% EQUIPMENT
    {}% ABILITIES
}

\newcommand\Animal[6]{
  \traits{#1}%
    {#2}%
    {{-6}{#3}{-6}}%
    {
      #4
    }
    {#5}
    {}% EQUIPMENT
    {#6}% ABILITIES
}

\statblock{
  \Animal{{\T[3]\A}{Moggie}}%
    {{2}{1}{3}}% BODY
    {2}% WITS
    {
      \setcounter{Stealth}{3}
    }%
    {}%
    {\quadraped}% ABILITIES
}

\showChar{
  \traits{{\F\Hu}{Alice}}%
    {{1}{2}{3}}%
    {{3}{0}{2}}%
    {
      \setcounter{Wyldcrafting}{1}
      \setcounter{Fire}{1}
      \setcounter{Air}{3}
    }% SKILLS
    {\adrenalinesurge, \mightydraw}% KNACKS
    {butter}% EQUIPMENT
    {}% ABILITIES
}

\showStdSpells

\toggletrue{examplecharacter}

\showChar{
  \traits{{\M\Hu}{Bob}}%
    {{1}{2}{3}}%
    {{-3}{-2}{-1}}%
    {
      \setcounter{Academics}{1}
      \longsword
      \partialleather
    }
    {\adrenalinesurge, \mightydraw}
    {\rations}% EQUIPMENT
    {}% ABILITIES
}


\showChar{
  \traits{{\F\Hu}{Charlie}}%
    {{3}{2}{-1}}%
    {{-3}{-2}{-1}}%
    {
      \setcounter{Xenomology}{1}
      \spear
      \completeplate
    }% SKILLS
    {\adrenalinesurge, \mightydraw}
    {stick}% EQUIPMENT
    {}% ABILITIES
}

\togglefalse{examplecharacter}


\showChar{
  \traits{{\T[7]\N}{\arabic{noAppearing} Goblins}}%
    {{-2}{1}{2}}%
    {{-3}{2}{-4}}%
    {
      \setcounter{Xenomology}{1}
      \setcounter{Projectiles}{2}
      \javelin
    }% SKILLS
    {}
    {\lootGoblin}% EQUIPMENT
    {
      \tentacles
      \web
      \mutation{r4}
    }% ABILITIES
}

\end{multicols}

\end{document}
